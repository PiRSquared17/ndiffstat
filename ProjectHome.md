### NDIFFSTAT ###

Some Source Code Management Systems are missing tools to do simple repository-changes analysis. For example with SVN (Subversion client) there is no simple way to locate the biggest changes between two revisions -AFAIK.

This project is an attempt to provide some diff-analysis functionalities in .NET. The first step was to make a **"diffstat-like" program in C#**.

_diffstat_ is a command-line utility written in C++ ([site](http://invisible-island.net/diffstat)) which can analyse a diff (difference between two files) and compute the number of added/deleted lines in the diff. It displays a nice ASCII-art histogram witch represents the amount of insertions/deletions in each files.

### Using NDiffStat (Console Program) ###

NDiffStat console program currently supports only two options :
  * -m : compute the number of lines modified
  * -f 4 : detailed output - display the number off added / deleted lines for each file (by default only total lines changed are displayed)

It has been designed to parse diffs generated by Subversion and Mercurial. It has not been tested with Git / Bazaar / CVS / ~whatever you want~...

```batch

Usage : ndiffstat [-m] [-f 4] DIFF_FILE
```

where DIFF\_FILE is an unified format diff. If DIFF\_FILE is not specified, NDiffStat will try to read from STDIN.

Example :
```batch

>svn diff -c 115715 "http://svn.wikimedia.org/svnroot/mediawiki/trunk/extensions" | ndiffstat.exe
BookInformation/BookInformation.i18n.php                   |    1
CategoryBrowser/CategoryBrowser.i18n.php                   |   24 ++++++------
CategoryIntersection/CategoryIntersection.i18n.php         |   12 ++++--
CategoryMultisort/CategoryMultisort.i18n.php               |    6 +-
CategoryMultisortChinese/CategoryMultisortChinese.i18n.php |    2
CooperationStatistics/CooperationStatistics.i18n.php       |   15 ++++---
MassEditRegex/MassEditRegex.i18n.php                       |    2
MultiUpload/MultiUpload.i18n.php                           |    5 ++
SemanticWebBrowser/SemanticWebBrowser.i18n.php             |    6 +-
9 files changed, 42 insertions(+), 31 deletions(-)
```

### (known) Output Differences with _diffstat_ (C++) ###
  * When `-m` option is enabled, the count of modified lines is different.
> For example if a diff contains the folowing lines, **diffstat** will count 3 modifications (as there is 3 delete and 3 inserts) whereas **NDiffStat** will count 2 modifications, one insertion and one delete (one modification + one deletion for the first list, one modification + one insert for the second list)

```
 first list
 ---
+foo
-bar
-other
 second list
 ---
+foo
+bar
-other
```

  * The histograms can be (slightly) differents
> The algorithm used by diffstat to compute the histogram is quite tricky. There are subtles ajustements to avoid that rounding errors make the histogram too short. At the moment NDiffStat is not so smart !

### Using NDiffStat Library ###
For example (assuming `NDiffStatLib.dll` is referenced in the C# project) this sample displays the three most modified files
```
using NDiffStatLib;
// ...
DiffStat diffStat = new DiffStat(new DiffStatOptions()); // default options
using (FileStream fs = File.OpenRead(@"path\to\myDiff.diff")) {
  using (StreamReader sr = new StreamReader(fs, Encoding.Default)) {
    diffStat.ParseDiff(sr);
  }
}
Console.WriteLine("Top modified files");
foreach (var fileStats in diffStat.FileStats.OrderByDescending(fstat => fstat.statsCounter.total).Take(3)) {
  Console.WriteLine("{0} ({1} lines changed)", fileStats.newFile, fileStats.statsCounter.total);
}

/* output:
   Top modified files
   CategoryBrowser/CategoryBrowser.i18n.php (24 lines changed)
   CooperationStatistics/CooperationStatistics.i18n.php (15 lines changed)
   CategoryIntersection/CategoryIntersection.i18n.php (12 lines changed)
 */
```

The aim of the API is to provide diff metrics to others programs, for example to display an HTML diffstat-like chart :

![http://chriswebpages.pagesperso-orange.fr/Images/codestat%20example.png](http://chriswebpages.pagesperso-orange.fr/Images/codestat%20example.png)